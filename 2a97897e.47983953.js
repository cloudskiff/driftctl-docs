(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{225:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),u=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(n),d=a,m=p["".concat(r,".").concat(d)]||p[d]||b[d]||o;return n?i.a.createElement(m,s(s({ref:t},l),{},{components:n})):i.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var l=2;l<o;l++)r[l]=n[l];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},96:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var a=n(3),i=n(7),o=(n(0),n(225)),r={id:"authentication",title:"Authentication"},s={unversionedId:"providers/aws/authentication",id:"version-0.7.1/providers/aws/authentication",isDocsHomePage:!1,title:"Authentication",description:"To use driftctl, we need credentials to make authenticated requests to AWS. Just like the AWS CLI, we use credentials and configuration settings declared as user environment variables, or in local AWS configuration files.",source:"@site/versioned_docs/version-0.7.1/providers/aws/authentication.mdx",slug:"/providers/aws/authentication",permalink:"/0.7.1/providers/aws/authentication",editUrl:"https://github.com/cloudskiff/driftctl-docs/edit/main/versioned_docs/version-0.7.1/providers/aws/authentication.mdx",version:"0.7.1",sidebar:"version-0.7.1/docs",previous:{title:"Log level",permalink:"/0.7.1/usage/log-level"},next:{title:"Supported Resources",permalink:"/0.7.1/providers/aws/resources"}},c=[{value:"CloudFormation template",id:"cloudformation-template",children:[{value:"Update the CloudFormation template",id:"update-the-cloudformation-template",children:[]}]},{value:"Least privileged policy",id:"least-privileged-policy",children:[]}],l={toc:c};function u(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"To use driftctl, we need credentials to make authenticated requests to AWS. Just like the AWS CLI, we use ",Object(o.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html"},"credentials and configuration")," settings declared as user environment variables, or in local AWS configuration files."),Object(o.b)("p",null,"driftctl supports ",Object(o.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html"},"named profile"),". By default, the CLI uses the settings found in the profile named ",Object(o.b)("inlineCode",{parentName:"p"},"default"),". You can override an individual setting by declaring the supported environment variables such as ",Object(o.b)("inlineCode",{parentName:"p"},"AWS_ACCESS_KEY_ID"),", ",Object(o.b)("inlineCode",{parentName:"p"},"AWS_SECRET_ACCESS_KEY"),", ",Object(o.b)("inlineCode",{parentName:"p"},"AWS_PROFILE")," ..."),Object(o.b)("p",null,"If you are using an ",Object(o.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html"},"IAM role")," as an authorization tool, which is considered a good practice, please be aware that you can still use driftctl by defining a profile for the role in your ",Object(o.b)("inlineCode",{parentName:"p"},"~/.aws/config")," file."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"[profile driftctlrole]\nrole_arn = arn:aws:iam::123456789012:role/<NAMEOFTHEROLE>\nsource_profile = user # profile to assume the role\nregion = eu-west-3\n")),Object(o.b)("p",null,"You can now use driftctl by overriding the profile setting."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"$ AWS_PROFILE=driftctlrole driftctl scan\n")),Object(o.b)("h2",{id:"cloudformation-template"},"CloudFormation template"),Object(o.b)("p",null,"Deploy this CloudFormation template to create our limited permission role that you can use as per our above authentication guide."),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://console.aws.amazon.com/cloudformation/home?#/stacks/quickcreate?stackName=driftctl-stack&templateURL=https://driftctl-cfn-templates.s3.eu-west-3.amazonaws.com/driftctl-role.yml"},Object(o.b)("img",{parentName:"a",src:"https://cdn.rawgit.com/buildkite/cloudformation-launch-stack-button-svg/master/launch-stack.svg",alt:"Launch Stack"}))),Object(o.b)("p",null,"Once the stack is deployed, you need to attach the following policy to your IAM User which will allow him to assume only the role. For more information about granting a user access to assume a role, see the official ",Object(o.b)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_permissions-to-switch.html"},"IAM User Guide"),"."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": "sts:AssumeRole",\n      "Resource": "arn:aws:iam::<IDOFYOURACCOUNT>:role/driftctl_assume_role"\n    }\n  ]\n}\n')),Object(o.b)("h3",{id:"update-the-cloudformation-template"},"Update the CloudFormation template"),Object(o.b)("p",null,"It does not exist an automatic way to update the CloudFormation template from our side because you launched this template on your AWS account. That's why you must be the one to update the template to be on the most recent driftctl role."),Object(o.b)("p",null,"Find below two ways to update the CloudFormation template:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"With the AWS console")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"In the ",Object(o.b)("a",{parentName:"li",href:"https://console.aws.amazon.com/cloudformation"},"AWS CloudFormation console"),", from the list of stacks, select the driftctl stack"),Object(o.b)("li",{parentName:"ul"},"In the stack details pane, choose ",Object(o.b)("strong",{parentName:"li"},"Update")),Object(o.b)("li",{parentName:"ul"},"Select ",Object(o.b)("strong",{parentName:"li"},"Replace current template")," and specify our ",Object(o.b)("strong",{parentName:"li"},"Amazon S3 URL")," ",Object(o.b)("inlineCode",{parentName:"li"},"https://driftctl-cfn-templates.s3.eu-west-3.amazonaws.com/driftctl-role.yml"),", click ",Object(o.b)("strong",{parentName:"li"},"Next")),Object(o.b)("li",{parentName:"ul"},"On the ",Object(o.b)("strong",{parentName:"li"},"Specify stack details")," and the ",Object(o.b)("strong",{parentName:"li"},"Configure stack options")," pages, click ",Object(o.b)("strong",{parentName:"li"},"Next")),Object(o.b)("li",{parentName:"ul"},"In the ",Object(o.b)("strong",{parentName:"li"},"Change set preview")," section, check that AWS CloudFormation will indeed make changes"),Object(o.b)("li",{parentName:"ul"},"Since our template contains one IAM resource, select ",Object(o.b)("strong",{parentName:"li"},"I acknowledge that this template may create IAM resources")),Object(o.b)("li",{parentName:"ul"},"Finally, click ",Object(o.b)("strong",{parentName:"li"},"Update stack"))),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"With the AWS CLI")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"$ aws cloudformation update-stack --stack-name DRIFTCTL_STACK_NAME --template-url https://driftctl-cfn-templates.s3.eu-west-3.amazonaws.com/driftctl-role.yml --capabilities CAPABILITY_NAMED_IAM\n")),Object(o.b)("h2",{id:"least-privileged-policy"},"Least privileged policy"),Object(o.b)("p",null,"driftctl needs access to your cloud provider account so that it can list resources on your behalf."),Object(o.b)("p",null,"As AWS documentation recommends, the below policy is granting only the permissions required to perform driftctl's tasks."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'{\n    "Version": "2012-10-17",\n    "Statement": [\n        {\n            "Effect": "Allow",\n            "Resource": "*",\n            "Action": [\n                "cloudfront:GetDistribution",\n                "cloudfront:ListDistributions",\n                "cloudfront:ListTagsForResource",\n                "ec2:DescribeAddresses",\n                "ec2:DescribeImages",\n                "ec2:DescribeInstanceAttribute",\n                "ec2:DescribeInstances",\n                "ec2:DescribeInstanceCreditSpecifications",\n                "ec2:DescribeInternetGateways",\n                "ec2:DescribeKeyPairs",\n                "ec2:DescribeNetworkAcls",\n                "ec2:DescribeRouteTables",\n                "ec2:DescribeSecurityGroups",\n                "ec2:DescribeSnapshots",\n                "ec2:DescribeTags",\n                "ec2:DescribeVolumes",\n                "ec2:DescribeVpcs",\n                "ec2:DescribeVpcAttribute",\n                "ec2:DescribeVpcClassicLink",\n                "ec2:DescribeVpcClassicLinkDnsSupport",\n                "ec2:DescribeSubnets",\n                "ec2:DescribeNatGateways",\n                "ecr:DescribeRepositories",\n                "ecr:ListTagsForResource",\n                "iam:GetPolicy",\n                "iam:GetPolicyVersion",\n                "iam:GetRole",\n                "iam:GetRolePolicy",\n                "iam:GetUser",\n                "iam:GetUserPolicy",\n                "iam:ListAccessKeys",\n                "iam:ListAttachedRolePolicies",\n                "iam:ListAttachedUserPolicies",\n                "iam:ListPolicies",\n                "iam:ListRolePolicies",\n                "iam:ListRoles",\n                "iam:ListUserPolicies",\n                "iam:ListUsers",\n                "kms:DescribeKey",\n                "kms:GetKeyPolicy",\n                "kms:GetKeyRotationStatus",\n                "kms:ListAliases",\n                "kms:ListKeys",\n                "kms:ListResourceTags",\n                "lambda:GetEventSourceMapping",\n                "lambda:GetFunction",\n                "lambda:GetFunctionCodeSigningConfig",\n                "lambda:ListEventSourceMappings",\n                "lambda:ListFunctions",\n                "lambda:ListVersionsByFunction",\n                "rds:DescribeDBInstances",\n                "rds:DescribeDBSubnetGroups",\n                "rds:ListTagsForResource",\n                "route53:GetHostedZone",\n                "route53:ListHostedZones",\n                "route53:ListResourceRecordSets",\n                "route53:ListTagsForResource",\n                "route53:ListHealthChecks",\n                "route53:GetHealthCheck",\n                "s3:GetAccelerateConfiguration",\n                "s3:GetAnalyticsConfiguration",\n                "s3:GetBucketAcl",\n                "s3:GetBucketCORS",\n                "s3:GetBucketLocation",\n                "s3:GetBucketLogging",\n                "s3:GetBucketNotification",\n                "s3:GetBucketObjectLockConfiguration",\n                "s3:GetBucketPolicy",\n                "s3:GetBucketRequestPayment",\n                "s3:GetBucketTagging",\n                "s3:GetBucketVersioning",\n                "s3:GetBucketWebsite",\n                "s3:GetEncryptionConfiguration",\n                "s3:GetInventoryConfiguration",\n                "s3:GetLifecycleConfiguration",\n                "s3:GetMetricsConfiguration",\n                "s3:GetReplicationConfiguration",\n                "s3:ListAllMyBuckets",\n                "s3:ListBucket",\n                "sqs:GetQueueAttributes",\n                "sqs:ListQueueTags",\n                "sqs:ListQueues",\n                "sns:ListTopics",\n                "sns:GetTopicAttributes",\n                "sns:ListTagsForResource",\n                "sns:ListSubscriptions",\n                "sns:ListSubscriptionsByTopic",\n                "sns:GetSubscriptionAttributes",\n                "dynamodb:ListTables",\n                "dynamodb:DescribeTable",\n                "dynamodb:DescribeGlobalTable",\n                "dynamodb:ListTagsOfResource",\n                "dynamodb:DescribeTimeToLive",\n                "dynamodb:DescribeTableReplicaAutoScaling",\n                "dynamodb:DescribeContinuousBackups"\n            ]\n        }\n    ]\n}\n')))}u.isMDXComponent=!0}}]);